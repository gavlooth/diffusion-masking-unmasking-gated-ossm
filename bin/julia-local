#!/usr/bin/env bash
#
# Wrapper that pins Julia/juliaup state inside the repository so the launcher
# can create its lockfiles even under the Codex sandbox.

set -euo pipefail

script_dir="$(cd -- "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
repo_root="$(cd -- "${script_dir}/.." && pwd)"

export JULIAUP_DEPOT_PATH="${repo_root}/.juliaup-config"
export JULIA_DEPOT_PATH="${repo_root}/.julia-depot"
export JULIA_PKG_DEVDIR="${repo_root}"
export JULIA_PROJECT="${repo_root}"

mkdir -p "${JULIAUP_DEPOT_PATH}"
mkdir -p "${JULIA_DEPOT_PATH}"

exec "${HOME}/.juliaup/bin/julia" "$@"
